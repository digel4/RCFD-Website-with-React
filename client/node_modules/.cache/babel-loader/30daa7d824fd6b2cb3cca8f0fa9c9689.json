{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\nexport default {\n  name: 'anchor',\n  add: function (core) {\n    core.addModule([selectMenu]);\n    core.context.anchor = {\n      caller: {},\n      forms: this.setDialogForm(core),\n      host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n      callerContext: null\n    };\n  },\n\n  /** dialog */\n  setDialogForm: function (core) {\n    const lang = core.lang;\n    const relList = core.options.linkRel;\n    const defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n    const icons = core.icons;\n    const forms = core.util.createElement('DIV');\n    let html = '<div class=\"se-dialog-body\">' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.url + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' + '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' + core.plugins.selectMenu.setForm() + '</div>' + '<div class=\"se-anchor-preview-form\">' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' + '<pre class=\"se-link-preview\"></pre>' + '</div>' + '</div>' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' + '</div>' + '<div class=\"se-dialog-form-footer\">' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n\n    if (relList.length > 0) {\n      html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' + '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' + '<div class=\"se-list-layer\">' + '<div class=\"se-list-inner\">' + '<ul class=\"se-list-basic se-list-checked\">';\n\n      for (let i = 0, len = relList.length, rel; i < len; i++) {\n        rel = relList[i];\n        html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n      }\n\n      html += '</ul></div></div></div>';\n    }\n\n    html += '</div></div>';\n    forms.innerHTML = html;\n    return forms;\n  },\n  initEvent: function (pluginName, forms) {\n    const anchorPlugin = this.plugins.anchor;\n    const context = this.context.anchor.caller[pluginName] = {\n      modal: forms,\n      urlInput: null,\n      linkDefaultRel: this.options.linkRelDefault,\n      defaultRel: this.options.linkRelDefault.default || '',\n      currentRel: [],\n      linkAnchor: null,\n      linkValue: '',\n      _change: false,\n      callerName: pluginName\n    };\n    if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n    if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n    if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n    context.urlInput = forms.querySelector('.se-input-url');\n    context.anchorText = forms.querySelector('._se_anchor_text');\n    context.newWindowCheck = forms.querySelector('._se_anchor_check');\n    context.downloadCheck = forms.querySelector('._se_anchor_download');\n    context.download = forms.querySelector('._se_anchor_download_icon');\n    context.preview = forms.querySelector('.se-link-preview');\n    context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n    context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n    this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n    const listContext = this.context.selectMenu.caller[pluginName];\n    /** rel */\n\n    if (this.options.linkRel.length > 0) {\n      context.relButton = forms.querySelector('.se-anchor-rel-btn');\n      context.relList = forms.querySelector('.se-list-layer');\n      context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n      context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n      context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n    }\n\n    context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n    context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n    context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n    context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n    context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n    context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n    context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n    context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n  },\n  on: function (contextAnchor, update) {\n    if (!update) {\n      this.plugins.anchor.init.call(this, contextAnchor);\n      contextAnchor.anchorText.value = this.getSelection().toString().trim();\n      contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n    } else if (contextAnchor.linkAnchor) {\n      this.context.dialog.updateModal = true;\n      const href = this.options.linkNoPrefix ? contextAnchor.linkAnchor.href.replace(contextAnchor.linkAnchor.origin + '/', '') : contextAnchor.linkAnchor.href;\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = /\\#.+$/.test(href) ? href.substr(href.lastIndexOf('#')) : href;\n      contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n      contextAnchor.newWindowCheck.checked = /_blank/i.test(contextAnchor.linkAnchor.target) ? true : false;\n      contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n    }\n\n    this.context.anchor.callerContext = contextAnchor;\n    this.plugins.anchor.setRel.call(this, contextAnchor, update && contextAnchor.linkAnchor ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n    this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n  },\n  _closeRelMenu: null,\n  toggleRelList: function (contextAnchor, show) {\n    if (!show) {\n      if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n    } else {\n      const target = contextAnchor.relButton;\n      const relList = contextAnchor.relList;\n      this.util.addClass(target, 'active');\n      relList.style.visibility = 'hidden';\n      relList.style.display = 'block';\n      if (!this.options.rtl) relList.style.left = target.offsetLeft + target.offsetWidth + 1 + 'px';else relList.style.left = target.offsetLeft - relList.offsetWidth - 1 + 'px';\n      relList.style.top = target.offsetTop + target.offsetHeight / 2 - relList.offsetHeight / 2 + 'px';\n      relList.style.visibility = '';\n\n      this.plugins.anchor._closeRelMenu = function (context, target, e) {\n        if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n        this.util.removeClass(target, 'active');\n        context.relList.style.display = 'none';\n        this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n        this.plugins.anchor._closeRelMenu = null;\n      }.bind(this, contextAnchor, target);\n\n      this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n    }\n  },\n  onClick_relButton: function (contextAnchor, e) {\n    this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n  },\n  onClick_relList: function (contextAnchor, e) {\n    const target = e.target;\n    const cmd = target.getAttribute('data-command');\n    if (!cmd) return;\n    const current = contextAnchor.currentRel;\n    const checked = this.util.toggleClass(target, 'se-checked');\n    const index = current.indexOf(cmd);\n\n    if (checked) {\n      if (index === -1) current.push(cmd);\n    } else {\n      if (index > -1) current.splice(index, 1);\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n  },\n  setRel: function (contextAnchor, relAttr) {\n    const relListEl = contextAnchor.relList;\n    const rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n    if (!relListEl) return;\n    const checkedRel = relListEl.querySelectorAll('button');\n\n    for (let i = 0, len = checkedRel.length, cmd; i < len; i++) {\n      cmd = checkedRel[i].getAttribute('data-command');\n\n      if (rels.indexOf(cmd) > -1) {\n        this.util.addClass(checkedRel[i], 'se-checked');\n      } else {\n        this.util.removeClass(checkedRel[i], 'se-checked');\n      }\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n  },\n  createHeaderList: function (contextAnchor, contextList, urlValue) {\n    const headers = this.util.getListChildren(this.context.element.wysiwyg, function (current) {\n      return /h[1-6]/i.test(current.nodeName);\n    });\n    if (headers.length === 0) return;\n    const valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n    const list = [];\n    let html = '';\n\n    for (let i = 0, len = headers.length, h; i < len; i++) {\n      h = headers[i];\n      if (!valueRegExp.test(h.textContent)) continue;\n      list.push(h);\n      html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n    }\n\n    if (list.length === 0) {\n      this.plugins.selectMenu.close.call(this, contextList);\n    } else {\n      this.plugins.selectMenu.createList(contextList, list, html);\n      this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n    }\n  },\n  _setMenuListPosition: function (contextAnchor, list) {\n    list.style.top = contextAnchor.urlInput.offsetHeight + 1 + 'px';\n  },\n  onKeyDownUrlInput: function (contextList, e) {\n    const keyCode = e.keyCode;\n\n    switch (keyCode) {\n      case 38:\n        // up\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n        break;\n\n      case 40:\n        // down\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n        break;\n\n      case 13:\n        // enter\n        if (contextList.index > -1) {\n          e.preventDefault();\n          e.stopPropagation();\n          this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n        }\n\n        break;\n    }\n  },\n  setHeaderBookmark: function (header) {\n    const contextAnchor = this.context.anchor.callerContext;\n\n    const id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n\n    header.id = id;\n    contextAnchor.urlInput.value = '#' + id;\n\n    if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n      contextAnchor.anchorText.value = header.textContent;\n    }\n\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n    this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    this.context.anchor.callerContext.urlInput.focus();\n  },\n  onChangeAnchorText: function (contextAnchor, e) {\n    contextAnchor._change = !!e.target.value.trim();\n  },\n  onChangeUrlInput: function (contextAnchor, e) {\n    const value = e.target.value.trim();\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n    if (/^#/.test(value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n  },\n  onFocusUrlInput: function (contextAnchor, contextLink) {\n    const value = contextAnchor.urlInput.value;\n    if (/^#/.test(value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n  },\n  onBlurUrlInput: function (contextList) {\n    this.plugins.selectMenu.close.call(this, contextList);\n  },\n  setLinkPreview: function (context, value) {\n    const preview = context.preview;\n    const protocol = this.options.linkProtocol;\n    const noPrefix = this.options.linkNoPrefix;\n    const reservedProtocol = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n    const sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n    context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : protocol && !reservedProtocol && !sameProtocol ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n    if (value.indexOf('#') === 0) {\n      context.bookmark.style.display = 'block';\n      this.util.addClass(context.bookmarkButton, 'active');\n    } else {\n      context.bookmark.style.display = 'none';\n      this.util.removeClass(context.bookmarkButton, 'active');\n    }\n\n    if (value.indexOf('#') === -1 && context.downloadCheck.checked) {\n      context.download.style.display = 'block';\n    } else {\n      context.download.style.display = 'none';\n    }\n  },\n  setCtx: function (anchor, contextAnchor) {\n    if (!anchor) return;\n    contextAnchor.linkAnchor = anchor;\n    contextAnchor.linkValue = anchor.href;\n    contextAnchor.currentRel = anchor.rel.split(\" \");\n  },\n  updateAnchor: function (anchor, url, alt, contextAnchor, notText) {\n    // download\n    if (!/^\\#/.test(url) && contextAnchor.downloadCheck.checked) {\n      anchor.setAttribute('download', alt || url);\n    } else {\n      anchor.removeAttribute('download');\n    } // new window\n\n\n    if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';else anchor.removeAttribute('target'); // rel\n\n    const rel = contextAnchor.currentRel.join(' ');\n    if (!rel) anchor.removeAttribute('rel');else anchor.rel = rel; // est url, alt\n\n    anchor.href = url;\n    anchor.setAttribute('alt', alt);\n\n    if (notText) {\n      if (anchor.children.length === 0) anchor.textContent = '';\n    } else {\n      anchor.textContent = alt;\n    }\n  },\n  createAnchor: function (contextAnchor, notText) {\n    if (contextAnchor.linkValue.length === 0) return null;\n    const url = contextAnchor.linkValue;\n    const anchor = contextAnchor.anchorText;\n    const anchorText = anchor.value.length === 0 ? url : anchor.value;\n    const oA = contextAnchor.linkAnchor || this.util.createElement('A');\n    this.plugins.anchor.updateAnchor(oA, url, anchorText, contextAnchor, notText);\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n    return oA;\n  },\n  onClick_bookmarkButton: function (contextAnchor) {\n    let url = contextAnchor.urlInput.value;\n\n    if (/^\\#/.test(url)) {\n      url = url.substr(1);\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    } else {\n      url = '#' + url;\n      contextAnchor.bookmark.style.display = 'block';\n      this.util.addClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.downloadCheck.checked = false;\n      contextAnchor.download.style.display = 'none';\n      this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n    }\n\n    contextAnchor.urlInput.value = url;\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n    contextAnchor.urlInput.focus();\n  },\n  onChange_newWindowCheck: function (contextAnchor, e) {\n    if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n\n    if (e.target.checked) {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    } else {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    }\n  },\n  onChange_downloadCheck: function (contextAnchor, e) {\n    if (e.target.checked) {\n      contextAnchor.download.style.display = 'block';\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    } else {\n      contextAnchor.download.style.display = 'none';\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    }\n  },\n  _relMerge: function (contextAnchor, relAttr) {\n    const current = contextAnchor.currentRel;\n    if (!relAttr) return current.join(' ');\n\n    if (/^only\\:/.test(relAttr)) {\n      relAttr = relAttr.replace(/^only\\:/, '').trim();\n      contextAnchor.currentRel = relAttr.split(' ');\n      return relAttr;\n    }\n\n    const rels = relAttr.split(' ');\n\n    for (let i = 0, len = rels.length, index; i < len; i++) {\n      index = current.indexOf(rels[i]);\n      if (index === -1) current.push(rels[i]);\n    }\n\n    return current.join(' ');\n  },\n  _relDelete: function (contextAnchor, relAttr) {\n    if (!relAttr) return contextAnchor.currentRel.join(' ');\n    if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n    const rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n    contextAnchor.currentRel = rels.split(' ');\n    return rels;\n  },\n  init: function (contextAnchor) {\n    contextAnchor.linkAnchor = null;\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n    contextAnchor.anchorText.value = '';\n    contextAnchor.newWindowCheck.checked = false;\n    contextAnchor.downloadCheck.checked = false;\n    contextAnchor._change = false;\n    this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n\n    if (contextAnchor.relList) {\n      this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n    }\n\n    this.context.anchor.callerContext = null;\n    this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n  }\n};","map":{"version":3,"sources":["C:/Users/Digel/Desktop/repos/RCFD-Website-with-React/node_modules/suneditor/src/plugins/modules/_anchor.js"],"names":["selectMenu","name","add","core","addModule","context","anchor","caller","forms","setDialogForm","host","_w","location","origin","pathname","replace","callerContext","lang","relList","options","linkRel","defaultRel","linkRelDefault","default","split","icons","util","createElement","html","dialogBox","linkBox","url","protocol","bookmark","plugins","setForm","download","text","newWindowCheck","downloadLinkCheck","length","i","len","rel","indexOf","checked","innerHTML","initEvent","pluginName","anchorPlugin","modal","urlInput","linkDefaultRel","currentRel","linkAnchor","linkValue","_change","callerName","trim","check_new_window","check_bookmark","querySelector","anchorText","downloadCheck","preview","bookmarkButton","call","listContext","relButton","relPreview","addEventListener","onClick_relButton","bind","onClick_relList","onChange_newWindowCheck","onChange_downloadCheck","onChangeAnchorText","onChangeUrlInput","onKeyDownUrlInput","onFocusUrlInput","onBlurUrlInput","onClick_bookmarkButton","on","contextAnchor","update","init","value","getSelection","toString","linkTargetNewWindow","dialog","updateModal","href","linkNoPrefix","textContent","test","substr","lastIndexOf","getAttribute","target","setRel","setLinkPreview","setHeaderBookmark","_closeRelMenu","toggleRelList","show","addClass","style","visibility","display","rtl","left","offsetLeft","offsetWidth","top","offsetTop","offsetHeight","e","contains","removeClass","modalForm","removeEventListener","hasClass","cmd","current","toggleClass","index","push","splice","title","join","relAttr","relListEl","rels","checkedRel","querySelectorAll","createHeaderList","contextList","urlValue","headers","getListChildren","element","wysiwyg","nodeName","valueRegExp","RegExp","list","h","close","createList","open","_setMenuListPosition","keyCode","preventDefault","stopPropagation","moveItem","getItem","header","id","Math","random","focus","contextLink","linkProtocol","noPrefix","reservedProtocol","sameProtocol","setCtx","updateAnchor","alt","notText","setAttribute","removeAttribute","children","createAnchor","oA","_relMerge","_relDelete"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,UAAP,MAAuB,eAAvB;AAEA,eAAe;AACXC,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,GAAG,EAAE,UAAUC,IAAV,EAAgB;AACjBA,IAAAA,IAAI,CAACC,SAAL,CAAe,CAACJ,UAAD,CAAf;AAEAG,IAAAA,IAAI,CAACE,OAAL,CAAaC,MAAb,GAAsB;AAClBC,MAAAA,MAAM,EAAE,EADU;AAElBC,MAAAA,KAAK,EAAE,KAAKC,aAAL,CAAmBN,IAAnB,CAFW;AAGlBO,MAAAA,IAAI,EAAE,CAACP,IAAI,CAACQ,EAAL,CAAQC,QAAR,CAAiBC,MAAjB,GAA0BV,IAAI,CAACQ,EAAL,CAAQC,QAAR,CAAiBE,QAA5C,EAAsDC,OAAtD,CAA8D,KAA9D,EAAqE,EAArE,CAHY;AAIlBC,MAAAA,aAAa,EAAE;AAJG,KAAtB;AAMH,GAXU;;AAaX;AACAP,EAAAA,aAAa,EAAE,UAAUN,IAAV,EAAgB;AAC3B,UAAMc,IAAI,GAAGd,IAAI,CAACc,IAAlB;AACA,UAAMC,OAAO,GAAGf,IAAI,CAACgB,OAAL,CAAaC,OAA7B;AACA,UAAMC,UAAU,GAAG,CAAClB,IAAI,CAACgB,OAAL,CAAaG,cAAb,CAA4BC,OAA5B,IAAuC,EAAxC,EAA4CC,KAA5C,CAAkD,GAAlD,CAAnB;AACA,UAAMC,KAAK,GAAGtB,IAAI,CAACsB,KAAnB;AACA,UAAMjB,KAAK,GAAGL,IAAI,CAACuB,IAAL,CAAUC,aAAV,CAAwB,KAAxB,CAAd;AAEA,QAAIC,IAAI,GAAG,iCACP,8BADO,GAEH,SAFG,GAESX,IAAI,CAACY,SAAL,CAAeC,OAAf,CAAuBC,GAFhC,GAEsC,UAFtC,GAGH,oCAHG,GAIC,qEAJD,IAI0E5B,IAAI,CAACgB,OAAL,CAAaa,QAAb,IAAyB,EAJnG,IAIyG,MAJzG,GAKC,8FALD,GAKkGf,IAAI,CAACY,SAAL,CAAeC,OAAf,CAAuBG,QALzH,GAKoI,IALpI,GAK2IR,KAAK,CAACQ,QALjJ,GAK4J,WAL5J,GAMC9B,IAAI,CAAC+B,OAAL,CAAalC,UAAb,CAAwBmC,OAAxB,EAND,GAOH,QAPG,GAQH,sCARG,GASC,uEATD,GAS2EV,KAAK,CAACQ,QATjF,GAS4F,SAT5F,GAUC,uEAVD,GAU2ER,KAAK,CAACW,QAVjF,GAU4F,SAV5F,GAWC,qCAXD,GAYH,QAZG,GAaP,QAbO,GAcP,8BAdO,GAeH,SAfG,GAeSnB,IAAI,CAACY,SAAL,CAAeC,OAAf,CAAuBO,IAfhC,GAeuC,qEAfvC,GAgBP,QAhBO,GAiBP,qCAjBO,GAkBH,qFAlBG,GAkBqFpB,IAAI,CAACY,SAAL,CAAeC,OAAf,CAAuBQ,cAlB5G,GAkB6H,UAlB7H,GAmBH,wFAnBG,GAmBwFrB,IAAI,CAACY,SAAL,CAAeC,OAAf,CAAuBS,iBAnB/G,GAmBmI,UAnB9I;;AAoBI,QAAIrB,OAAO,CAACsB,MAAR,GAAiB,CAArB,EAAwB;AACpBZ,MAAAA,IAAI,IAAI,yHACJ,oGADI,GAEJ,6BAFI,GAGA,6BAHA,GAII,4CAJZ;;AAKA,WAAK,IAAIa,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGxB,OAAO,CAACsB,MAAzB,EAAiCG,GAAtC,EAA2CF,CAAC,GAAGC,GAA/C,EAAoDD,CAAC,EAArD,EAAyD;AACrDE,QAAAA,GAAG,GAAGzB,OAAO,CAACuB,CAAD,CAAb;AACAb,QAAAA,IAAI,IAAI,kDAAkDP,UAAU,CAACuB,OAAX,CAAmBD,GAAnB,IAA0B,CAAC,CAA3B,GAA+B,aAA/B,GAA+C,EAAjG,IAAuG,kBAAvG,GAA4HA,GAA5H,GAAkI,WAAlI,GAAgJA,GAAhJ,GAAsJ,yBAAtJ,GAAkLlB,KAAK,CAACoB,OAAxL,GAAkM,SAAlM,GAA8MF,GAA9M,GAAoN,gBAA5N;AACH;;AACDf,MAAAA,IAAI,IAAI,yBAAR;AACH;;AAELA,IAAAA,IAAI,IAAI,cAAR;AAEApB,IAAAA,KAAK,CAACsC,SAAN,GAAkBlB,IAAlB;AACA,WAAOpB,KAAP;AACH,GA1DU;AA4DXuC,EAAAA,SAAS,EAAE,UAAUC,UAAV,EAAsBxC,KAAtB,EAA6B;AACpC,UAAMyC,YAAY,GAAG,KAAKf,OAAL,CAAa5B,MAAlC;AACA,UAAMD,OAAO,GAAG,KAAKA,OAAL,CAAaC,MAAb,CAAoBC,MAApB,CAA2ByC,UAA3B,IAAyC;AACrDE,MAAAA,KAAK,EAAE1C,KAD8C;AAErD2C,MAAAA,QAAQ,EAAE,IAF2C;AAGrDC,MAAAA,cAAc,EAAE,KAAKjC,OAAL,CAAaG,cAHwB;AAIrDD,MAAAA,UAAU,EAAE,KAAKF,OAAL,CAAaG,cAAb,CAA4BC,OAA5B,IAAuC,EAJE;AAKrD8B,MAAAA,UAAU,EAAE,EALyC;AAMrDC,MAAAA,UAAU,EAAE,IANyC;AAOrDC,MAAAA,SAAS,EAAE,EAP0C;AAQrDC,MAAAA,OAAO,EAAE,KAR4C;AASrDC,MAAAA,UAAU,EAAET;AATyC,KAAzD;AAYA,QAAI,OAAO3C,OAAO,CAAC+C,cAAR,CAAuB7B,OAA9B,KAA0C,QAA9C,EAAwDlB,OAAO,CAAC+C,cAAR,CAAuB7B,OAAvB,GAAiClB,OAAO,CAAC+C,cAAR,CAAuB7B,OAAvB,CAA+BmC,IAA/B,EAAjC;AACxD,QAAI,OAAOrD,OAAO,CAAC+C,cAAR,CAAuBO,gBAA9B,KAAmD,QAAvD,EAAiEtD,OAAO,CAAC+C,cAAR,CAAuBO,gBAAvB,GAA0CtD,OAAO,CAAC+C,cAAR,CAAuBO,gBAAvB,CAAwCD,IAAxC,EAA1C;AACjE,QAAI,OAAOrD,OAAO,CAAC+C,cAAR,CAAuBQ,cAA9B,KAAiD,QAArD,EAA+DvD,OAAO,CAAC+C,cAAR,CAAuBQ,cAAvB,GAAwCvD,OAAO,CAAC+C,cAAR,CAAuBQ,cAAvB,CAAsCF,IAAtC,EAAxC;AAE/DrD,IAAAA,OAAO,CAAC8C,QAAR,GAAmB3C,KAAK,CAACqD,aAAN,CAAoB,eAApB,CAAnB;AACAxD,IAAAA,OAAO,CAACyD,UAAR,GAAqBtD,KAAK,CAACqD,aAAN,CAAoB,kBAApB,CAArB;AACAxD,IAAAA,OAAO,CAACiC,cAAR,GAAyB9B,KAAK,CAACqD,aAAN,CAAoB,mBAApB,CAAzB;AACAxD,IAAAA,OAAO,CAAC0D,aAAR,GAAwBvD,KAAK,CAACqD,aAAN,CAAoB,sBAApB,CAAxB;AACAxD,IAAAA,OAAO,CAAC+B,QAAR,GAAmB5B,KAAK,CAACqD,aAAN,CAAoB,2BAApB,CAAnB;AACAxD,IAAAA,OAAO,CAAC2D,OAAR,GAAkBxD,KAAK,CAACqD,aAAN,CAAoB,kBAApB,CAAlB;AACAxD,IAAAA,OAAO,CAAC4B,QAAR,GAAmBzB,KAAK,CAACqD,aAAN,CAAoB,2BAApB,CAAnB;AACAxD,IAAAA,OAAO,CAAC4D,cAAR,GAAyBzD,KAAK,CAACqD,aAAN,CAAoB,sBAApB,CAAzB;AAEA,SAAK3B,OAAL,CAAalC,UAAb,CAAwB+C,SAAxB,CAAkCmB,IAAlC,CAAuC,IAAvC,EAA6ClB,UAA7C,EAAyDxC,KAAzD;AACA,UAAM2D,WAAW,GAAG,KAAK9D,OAAL,CAAaL,UAAb,CAAwBO,MAAxB,CAA+ByC,UAA/B,CAApB;AAEA;;AACA,QAAI,KAAK7B,OAAL,CAAaC,OAAb,CAAqBoB,MAArB,GAA8B,CAAlC,EAAqC;AACjCnC,MAAAA,OAAO,CAAC+D,SAAR,GAAoB5D,KAAK,CAACqD,aAAN,CAAoB,oBAApB,CAApB;AACAxD,MAAAA,OAAO,CAACa,OAAR,GAAkBV,KAAK,CAACqD,aAAN,CAAoB,gBAApB,CAAlB;AACAxD,MAAAA,OAAO,CAACgE,UAAR,GAAqB7D,KAAK,CAACqD,aAAN,CAAoB,wBAApB,CAArB;AACAxD,MAAAA,OAAO,CAAC+D,SAAR,CAAkBE,gBAAlB,CAAmC,OAAnC,EAA4CrB,YAAY,CAACsB,iBAAb,CAA+BC,IAA/B,CAAoC,IAApC,EAA0CnE,OAA1C,CAA5C;AACAA,MAAAA,OAAO,CAACa,OAAR,CAAgBoD,gBAAhB,CAAiC,OAAjC,EAA0CrB,YAAY,CAACwB,eAAb,CAA6BD,IAA7B,CAAkC,IAAlC,EAAwCnE,OAAxC,CAA1C;AACH;;AAEDA,IAAAA,OAAO,CAACiC,cAAR,CAAuBgC,gBAAvB,CAAwC,QAAxC,EAAkDrB,YAAY,CAACyB,uBAAb,CAAqCF,IAArC,CAA0C,IAA1C,EAAgDnE,OAAhD,CAAlD;AACAA,IAAAA,OAAO,CAAC0D,aAAR,CAAsBO,gBAAtB,CAAuC,QAAvC,EAAiDrB,YAAY,CAAC0B,sBAAb,CAAoCH,IAApC,CAAyC,IAAzC,EAA+CnE,OAA/C,CAAjD;AACAA,IAAAA,OAAO,CAACyD,UAAR,CAAmBQ,gBAAnB,CAAoC,OAApC,EAA6CrB,YAAY,CAAC2B,kBAAb,CAAgCJ,IAAhC,CAAqC,IAArC,EAA2CnE,OAA3C,CAA7C;AACAA,IAAAA,OAAO,CAAC8C,QAAR,CAAiBmB,gBAAjB,CAAkC,OAAlC,EAA2CrB,YAAY,CAAC4B,gBAAb,CAA8BL,IAA9B,CAAmC,IAAnC,EAAyCnE,OAAzC,CAA3C;AACAA,IAAAA,OAAO,CAAC8C,QAAR,CAAiBmB,gBAAjB,CAAkC,SAAlC,EAA6CrB,YAAY,CAAC6B,iBAAb,CAA+BN,IAA/B,CAAoC,IAApC,EAA0CL,WAA1C,CAA7C;AACA9D,IAAAA,OAAO,CAAC8C,QAAR,CAAiBmB,gBAAjB,CAAkC,OAAlC,EAA2CrB,YAAY,CAAC8B,eAAb,CAA6BP,IAA7B,CAAkC,IAAlC,EAAwCnE,OAAxC,EAAiD8D,WAAjD,CAA3C;AACA9D,IAAAA,OAAO,CAAC8C,QAAR,CAAiBmB,gBAAjB,CAAkC,MAAlC,EAA0CrB,YAAY,CAAC+B,cAAb,CAA4BR,IAA5B,CAAiC,IAAjC,EAAuCL,WAAvC,CAA1C;AACA9D,IAAAA,OAAO,CAAC4D,cAAR,CAAuBK,gBAAvB,CAAwC,OAAxC,EAAiDrB,YAAY,CAACgC,sBAAb,CAAoCT,IAApC,CAAyC,IAAzC,EAA+CnE,OAA/C,CAAjD;AACH,GA3GU;AA6GX6E,EAAAA,EAAE,EAAE,UAAUC,aAAV,EAAyBC,MAAzB,EAAiC;AACjC,QAAI,CAACA,MAAL,EAAa;AACT,WAAKlD,OAAL,CAAa5B,MAAb,CAAoB+E,IAApB,CAAyBnB,IAAzB,CAA8B,IAA9B,EAAoCiB,aAApC;AACAA,MAAAA,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,GAAiC,KAAKC,YAAL,GAAoBC,QAApB,GAA+B9B,IAA/B,EAAjC;AACAyB,MAAAA,aAAa,CAAC7C,cAAd,CAA6BO,OAA7B,GAAuC,KAAK1B,OAAL,CAAasE,mBAApD;AACH,KAJD,MAIO,IAAIN,aAAa,CAAC7B,UAAlB,EAA8B;AACjC,WAAKjD,OAAL,CAAaqF,MAAb,CAAoBC,WAApB,GAAkC,IAAlC;AACA,YAAMC,IAAI,GAAG,KAAKzE,OAAL,CAAa0E,YAAb,GAA4BV,aAAa,CAAC7B,UAAd,CAAyBsC,IAAzB,CAA8B7E,OAA9B,CAAsCoE,aAAa,CAAC7B,UAAd,CAAyBzC,MAAzB,GAAkC,GAAxE,EAA6E,EAA7E,CAA5B,GAA+GsE,aAAa,CAAC7B,UAAd,CAAyBsC,IAArJ;AACAT,MAAAA,aAAa,CAAC5B,SAAd,GAA0B4B,aAAa,CAACnB,OAAd,CAAsB8B,WAAtB,GAAoCX,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+B,QAAQS,IAAR,CAAaH,IAAb,IAAqBA,IAAI,CAACI,MAAL,CAAYJ,IAAI,CAACK,WAAL,CAAiB,GAAjB,CAAZ,CAArB,GAA0DL,IAAvJ;AACAT,MAAAA,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,GAAiCH,aAAa,CAAC7B,UAAd,CAAyBwC,WAAzB,IAAwCX,aAAa,CAAC7B,UAAd,CAAyB4C,YAAzB,CAAsC,KAAtC,CAAzE;AACAf,MAAAA,aAAa,CAAC7C,cAAd,CAA6BO,OAA7B,GAAwC,UAAUkD,IAAV,CAAeZ,aAAa,CAAC7B,UAAd,CAAyB6C,MAAxC,IAAkD,IAAlD,GAAyD,KAAjG;AACAhB,MAAAA,aAAa,CAACpB,aAAd,CAA4BlB,OAA5B,GAAsCsC,aAAa,CAAC7B,UAAd,CAAyBlB,QAA/D;AACH;;AAED,SAAK/B,OAAL,CAAaC,MAAb,CAAoBU,aAApB,GAAoCmE,aAApC;AACA,SAAKjD,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAsDC,MAAM,IAAID,aAAa,CAAC7B,UAAzB,GAAuC6B,aAAa,CAAC7B,UAAd,CAAyBX,GAAhE,GAAsEwC,aAAa,CAAC9D,UAAzI;AACA,SAAKa,OAAL,CAAa5B,MAAb,CAAoB+F,cAApB,CAAmCnC,IAAnC,CAAwC,IAAxC,EAA8CiB,aAA9C,EAA6DA,aAAa,CAAC5B,SAA3E;AACA,SAAKrB,OAAL,CAAalC,UAAb,CAAwBkF,EAAxB,CAA2BhB,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAa,CAAC1B,UAApD,EAAgE,KAAKvB,OAAL,CAAa5B,MAAb,CAAoBgG,iBAApF;AACH,GA/HU;AAiIXC,EAAAA,aAAa,EAAE,IAjIJ;AAkIXC,EAAAA,aAAa,EAAE,UAAUrB,aAAV,EAAyBsB,IAAzB,EAA+B;AAC1C,QAAI,CAACA,IAAL,EAAW;AACP,UAAI,KAAKvE,OAAL,CAAa5B,MAAb,CAAoBiG,aAAxB,EAAuC,KAAKrE,OAAL,CAAa5B,MAAb,CAAoBiG,aAApB;AAC1C,KAFD,MAEO;AACH,YAAMJ,MAAM,GAAGhB,aAAa,CAACf,SAA7B;AACA,YAAMlD,OAAO,GAAGiE,aAAa,CAACjE,OAA9B;AACA,WAAKQ,IAAL,CAAUgF,QAAV,CAAmBP,MAAnB,EAA2B,QAA3B;AACAjF,MAAAA,OAAO,CAACyF,KAAR,CAAcC,UAAd,GAA2B,QAA3B;AACA1F,MAAAA,OAAO,CAACyF,KAAR,CAAcE,OAAd,GAAwB,OAAxB;AACA,UAAI,CAAC,KAAK1F,OAAL,CAAa2F,GAAlB,EAAuB5F,OAAO,CAACyF,KAAR,CAAcI,IAAd,GAAsBZ,MAAM,CAACa,UAAP,GAAoBb,MAAM,CAACc,WAA3B,GAAyC,CAA1C,GAA+C,IAApE,CAAvB,KACK/F,OAAO,CAACyF,KAAR,CAAcI,IAAd,GAAsBZ,MAAM,CAACa,UAAP,GAAoB9F,OAAO,CAAC+F,WAA5B,GAA0C,CAA3C,GAAgD,IAArE;AACL/F,MAAAA,OAAO,CAACyF,KAAR,CAAcO,GAAd,GAAqBf,MAAM,CAACgB,SAAP,GAAoBhB,MAAM,CAACiB,YAAP,GAAsB,CAA1C,GAAgDlG,OAAO,CAACkG,YAAR,GAAuB,CAAxE,GAA8E,IAAlG;AACAlG,MAAAA,OAAO,CAACyF,KAAR,CAAcC,UAAd,GAA2B,EAA3B;;AAEA,WAAK1E,OAAL,CAAa5B,MAAb,CAAoBiG,aAApB,GAAoC,UAAUlG,OAAV,EAAmB8F,MAAnB,EAA2BkB,CAA3B,EAA8B;AAC9D,YAAIA,CAAC,KAAKhH,OAAO,CAAC+D,SAAR,CAAkBkD,QAAlB,CAA2BD,CAAC,CAAClB,MAA7B,KAAwC9F,OAAO,CAACa,OAAR,CAAgBoG,QAAhB,CAAyBD,CAAC,CAAClB,MAA3B,CAA7C,CAAL,EAAuF;AACvF,aAAKzE,IAAL,CAAU6F,WAAV,CAAsBpB,MAAtB,EAA8B,QAA9B;AACA9F,QAAAA,OAAO,CAACa,OAAR,CAAgByF,KAAhB,CAAsBE,OAAtB,GAAgC,MAAhC;AACA,aAAKW,SAAL,CAAeC,mBAAf,CAAmC,OAAnC,EAA4C,KAAKvF,OAAL,CAAa5B,MAAb,CAAoBiG,aAAhE;AACA,aAAKrE,OAAL,CAAa5B,MAAb,CAAoBiG,aAApB,GAAoC,IAApC;AACH,OANmC,CAMlC/B,IANkC,CAM7B,IAN6B,EAMvBW,aANuB,EAMRgB,MANQ,CAApC;;AAQA,WAAKqB,SAAL,CAAelD,gBAAf,CAAgC,OAAhC,EAAyC,KAAKpC,OAAL,CAAa5B,MAAb,CAAoBiG,aAA7D;AACH;AACJ,GA1JU;AA4JXhC,EAAAA,iBAAiB,EAAE,UAAUY,aAAV,EAAyBkC,CAAzB,EAA4B;AAC3C,SAAKnF,OAAL,CAAa5B,MAAb,CAAoBkG,aAApB,CAAkCtC,IAAlC,CAAuC,IAAvC,EAA6CiB,aAA7C,EAA4D,CAAC,KAAKzD,IAAL,CAAUgG,QAAV,CAAmBL,CAAC,CAAClB,MAArB,EAA6B,QAA7B,CAA7D;AACH,GA9JU;AAgKX1B,EAAAA,eAAe,EAAE,UAAUU,aAAV,EAAyBkC,CAAzB,EAA4B;AACzC,UAAMlB,MAAM,GAAGkB,CAAC,CAAClB,MAAjB;AACA,UAAMwB,GAAG,GAAGxB,MAAM,CAACD,YAAP,CAAoB,cAApB,CAAZ;AACA,QAAI,CAACyB,GAAL,EAAU;AAEV,UAAMC,OAAO,GAAGzC,aAAa,CAAC9B,UAA9B;AACA,UAAMR,OAAO,GAAG,KAAKnB,IAAL,CAAUmG,WAAV,CAAsB1B,MAAtB,EAA8B,YAA9B,CAAhB;AACA,UAAM2B,KAAK,GAAGF,OAAO,CAAChF,OAAR,CAAgB+E,GAAhB,CAAd;;AACA,QAAI9E,OAAJ,EAAa;AACT,UAAIiF,KAAK,KAAK,CAAC,CAAf,EAAkBF,OAAO,CAACG,IAAR,CAAaJ,GAAb;AACrB,KAFD,MAEO;AACH,UAAIG,KAAK,GAAG,CAAC,CAAb,EAAgBF,OAAO,CAACI,MAAR,CAAeF,KAAf,EAAsB,CAAtB;AACnB;;AAED3C,IAAAA,aAAa,CAACd,UAAd,CAAyB4D,KAAzB,GAAiC9C,aAAa,CAACd,UAAd,CAAyByB,WAAzB,GAAuC8B,OAAO,CAACM,IAAR,CAAa,GAAb,CAAxE;AACH,GA/KU;AAiLX9B,EAAAA,MAAM,EAAE,UAAUjB,aAAV,EAAyBgD,OAAzB,EAAkC;AACtC,UAAMC,SAAS,GAAGjD,aAAa,CAACjE,OAAhC;AACA,UAAMmH,IAAI,GAAGlD,aAAa,CAAC9B,UAAd,GAA2B,CAAC8E,OAAD,GAAW,EAAX,GAAgBA,OAAO,CAAC3G,KAAR,CAAc,GAAd,CAAxD;AACA,QAAI,CAAC4G,SAAL,EAAgB;AAEhB,UAAME,UAAU,GAAGF,SAAS,CAACG,gBAAV,CAA2B,QAA3B,CAAnB;;AACA,SAAK,IAAI9F,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG4F,UAAU,CAAC9F,MAA5B,EAAoCmF,GAAzC,EAA8ClF,CAAC,GAAGC,GAAlD,EAAuDD,CAAC,EAAxD,EAA4D;AACxDkF,MAAAA,GAAG,GAAGW,UAAU,CAAC7F,CAAD,CAAV,CAAcyD,YAAd,CAA2B,cAA3B,CAAN;;AACA,UAAImC,IAAI,CAACzF,OAAL,CAAa+E,GAAb,IAAoB,CAAC,CAAzB,EAA4B;AACxB,aAAKjG,IAAL,CAAUgF,QAAV,CAAmB4B,UAAU,CAAC7F,CAAD,CAA7B,EAAkC,YAAlC;AACH,OAFD,MAEO;AACH,aAAKf,IAAL,CAAU6F,WAAV,CAAsBe,UAAU,CAAC7F,CAAD,CAAhC,EAAqC,YAArC;AACH;AACJ;;AAED0C,IAAAA,aAAa,CAACd,UAAd,CAAyB4D,KAAzB,GAAiC9C,aAAa,CAACd,UAAd,CAAyByB,WAAzB,GAAuCuC,IAAI,CAACH,IAAL,CAAU,GAAV,CAAxE;AACH,GAjMU;AAmMXM,EAAAA,gBAAgB,EAAE,UAAUrD,aAAV,EAAyBsD,WAAzB,EAAsCC,QAAtC,EAAgD;AAC9D,UAAMC,OAAO,GAAG,KAAKjH,IAAL,CAAUkH,eAAV,CAA0B,KAAKvI,OAAL,CAAawI,OAAb,CAAqBC,OAA/C,EAAwD,UAASlB,OAAT,EAAkB;AACtF,aAAO,UAAU7B,IAAV,CAAe6B,OAAO,CAACmB,QAAvB,CAAP;AACH,KAFe,CAAhB;AAGA,QAAIJ,OAAO,CAACnG,MAAR,KAAmB,CAAvB,EAA0B;AAE1B,UAAMwG,WAAW,GAAG,IAAI,KAAKrI,EAAL,CAAQsI,MAAZ,CAAmB,MAAMP,QAAQ,CAAC3H,OAAT,CAAiB,IAAjB,EAAuB,EAAvB,CAAzB,EAAqD,GAArD,CAApB;AACA,UAAMmI,IAAI,GAAG,EAAb;AACA,QAAItH,IAAI,GAAG,EAAX;;AACA,SAAI,IAAIa,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGiG,OAAO,CAACnG,MAAzB,EAAiC2G,CAArC,EAAwC1G,CAAC,GAAGC,GAA5C,EAAiDD,CAAC,EAAlD,EAAsD;AAClD0G,MAAAA,CAAC,GAAGR,OAAO,CAAClG,CAAD,CAAX;AACA,UAAI,CAACuG,WAAW,CAACjD,IAAZ,CAAiBoD,CAAC,CAACrD,WAAnB,CAAL,EAAsC;AACtCoD,MAAAA,IAAI,CAACnB,IAAL,CAAUoB,CAAV;AACAvH,MAAAA,IAAI,IAAI,4CAA4Ca,CAA5C,GAAgD,IAAhD,GAAuD0G,CAAC,CAACrD,WAAzD,GAAuE,OAA/E;AACH;;AAED,QAAIoD,IAAI,CAAC1G,MAAL,KAAgB,CAApB,EAAuB;AACnB,WAAKN,OAAL,CAAalC,UAAb,CAAwBoJ,KAAxB,CAA8BlF,IAA9B,CAAmC,IAAnC,EAAyCuE,WAAzC;AACH,KAFD,MAEO;AACH,WAAKvG,OAAL,CAAalC,UAAb,CAAwBqJ,UAAxB,CAAmCZ,WAAnC,EAAgDS,IAAhD,EAAsDtH,IAAtD;AACA,WAAKM,OAAL,CAAalC,UAAb,CAAwBsJ,IAAxB,CAA6BpF,IAA7B,CAAkC,IAAlC,EAAwCuE,WAAxC,EAAqD,KAAKvG,OAAL,CAAa5B,MAAb,CAAoBiJ,oBAApB,CAAyC/E,IAAzC,CAA8C,IAA9C,EAAoDW,aAApD,CAArD;AACH;AACJ,GAzNU;AA2NXoE,EAAAA,oBAAoB,EAAE,UAAUpE,aAAV,EAAyB+D,IAAzB,EAA+B;AACjDA,IAAAA,IAAI,CAACvC,KAAL,CAAWO,GAAX,GAAkB/B,aAAa,CAAChC,QAAd,CAAuBiE,YAAvB,GAAsC,CAAvC,GAA4C,IAA7D;AACH,GA7NU;AA+NXtC,EAAAA,iBAAiB,EAAE,UAAU2D,WAAV,EAAuBpB,CAAvB,EAA0B;AACzC,UAAMmC,OAAO,GAAGnC,CAAC,CAACmC,OAAlB;;AACA,YAAQA,OAAR;AACI,WAAK,EAAL;AAAS;AACLnC,QAAAA,CAAC,CAACoC,cAAF;AACApC,QAAAA,CAAC,CAACqC,eAAF;AACA,aAAKxH,OAAL,CAAalC,UAAb,CAAwB2J,QAAxB,CAAiCzF,IAAjC,CAAsC,IAAtC,EAA4CuE,WAA5C,EAAyD,CAAC,CAA1D;AACA;;AACJ,WAAK,EAAL;AAAS;AACLpB,QAAAA,CAAC,CAACoC,cAAF;AACApC,QAAAA,CAAC,CAACqC,eAAF;AACA,aAAKxH,OAAL,CAAalC,UAAb,CAAwB2J,QAAxB,CAAiCzF,IAAjC,CAAsC,IAAtC,EAA4CuE,WAA5C,EAAyD,CAAzD;AACA;;AACJ,WAAK,EAAL;AAAS;AACL,YAAIA,WAAW,CAACX,KAAZ,GAAoB,CAAC,CAAzB,EAA4B;AACxBT,UAAAA,CAAC,CAACoC,cAAF;AACApC,UAAAA,CAAC,CAACqC,eAAF;AACA,eAAKxH,OAAL,CAAa5B,MAAb,CAAoBgG,iBAApB,CAAsCpC,IAAtC,CAA2C,IAA3C,EAAiD,KAAKhC,OAAL,CAAalC,UAAb,CAAwB4J,OAAxB,CAAgCnB,WAAhC,EAA6C,IAA7C,CAAjD;AACH;;AACD;AAjBR;AAmBH,GApPU;AAsPXnC,EAAAA,iBAAiB,EAAE,UAAUuD,MAAV,EAAkB;AACjC,UAAM1E,aAAa,GAAG,KAAK9E,OAAL,CAAaC,MAAb,CAAoBU,aAA1C;;AACA,UAAM8I,EAAE,GAAGD,MAAM,CAACC,EAAP,IAAa,OAAO,KAAKnJ,EAAL,CAAQoJ,IAAR,CAAaC,MAAb,GAAsBxE,QAAtB,GAAiCzE,OAAjC,CAAyC,MAAzC,EAAiD,EAAjD,CAA/B;;AACA8I,IAAAA,MAAM,CAACC,EAAP,GAAYA,EAAZ;AACA3E,IAAAA,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+B,MAAMwE,EAArC;;AAEA,QAAI,CAAC3E,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,CAA+B5B,IAA/B,EAAD,IAA0C,CAACyB,aAAa,CAAC3B,OAA7D,EAAsE;AAClE2B,MAAAA,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,GAAiCuE,MAAM,CAAC/D,WAAxC;AACH;;AAED,SAAK5D,OAAL,CAAa5B,MAAb,CAAoB+F,cAApB,CAAmCnC,IAAnC,CAAwC,IAAxC,EAA8CiB,aAA9C,EAA6DA,aAAa,CAAChC,QAAd,CAAuBmC,KAApF;AACA,SAAKpD,OAAL,CAAalC,UAAb,CAAwBoJ,KAAxB,CAA8BlF,IAA9B,CAAmC,IAAnC,EAAyC,KAAK7D,OAAL,CAAaL,UAAb,CAAwBgB,aAAjE;AACA,SAAKX,OAAL,CAAaC,MAAb,CAAoBU,aAApB,CAAkCmC,QAAlC,CAA2C8G,KAA3C;AACH,GAnQU;AAqQXrF,EAAAA,kBAAkB,EAAE,UAAUO,aAAV,EAAyBkC,CAAzB,EAA4B;AAC5ClC,IAAAA,aAAa,CAAC3B,OAAd,GAAwB,CAAC,CAAC6D,CAAC,CAAClB,MAAF,CAASb,KAAT,CAAe5B,IAAf,EAA1B;AACH,GAvQU;AAyQXmB,EAAAA,gBAAgB,EAAE,UAAUM,aAAV,EAAyBkC,CAAzB,EAA4B;AAC1C,UAAM/B,KAAK,GAAG+B,CAAC,CAAClB,MAAF,CAASb,KAAT,CAAe5B,IAAf,EAAd;AACA,SAAKxB,OAAL,CAAa5B,MAAb,CAAoB+F,cAApB,CAAmCnC,IAAnC,CAAwC,IAAxC,EAA8CiB,aAA9C,EAA6DG,KAA7D;AAEA,QAAI,KAAKS,IAAL,CAAUT,KAAV,CAAJ,EAAsB,KAAKpD,OAAL,CAAa5B,MAAb,CAAoBkI,gBAApB,CAAqCtE,IAArC,CAA0C,IAA1C,EAAgDiB,aAAhD,EAA+D,KAAK9E,OAAL,CAAaL,UAAb,CAAwBgB,aAAvF,EAAsGsE,KAAtG,EAAtB,KACK,KAAKpD,OAAL,CAAalC,UAAb,CAAwBoJ,KAAxB,CAA8BlF,IAA9B,CAAmC,IAAnC,EAAyC,KAAK7D,OAAL,CAAaL,UAAb,CAAwBgB,aAAjE;AACR,GA/QU;AAiRX+D,EAAAA,eAAe,EAAE,UAAUI,aAAV,EAAyB+E,WAAzB,EAAsC;AACnD,UAAM5E,KAAK,GAAGH,aAAa,CAAChC,QAAd,CAAuBmC,KAArC;AACA,QAAI,KAAKS,IAAL,CAAUT,KAAV,CAAJ,EAAsB,KAAKpD,OAAL,CAAa5B,MAAb,CAAoBkI,gBAApB,CAAqCtE,IAArC,CAA0C,IAA1C,EAAgDiB,aAAhD,EAA+D+E,WAA/D,EAA4E5E,KAA5E;AACzB,GApRU;AAsRXN,EAAAA,cAAc,EAAE,UAAUyD,WAAV,EAAuB;AACnC,SAAKvG,OAAL,CAAalC,UAAb,CAAwBoJ,KAAxB,CAA8BlF,IAA9B,CAAmC,IAAnC,EAAyCuE,WAAzC;AACH,GAxRU;AA0RXpC,EAAAA,cAAc,EAAE,UAAUhG,OAAV,EAAmBiF,KAAnB,EAA0B;AACtC,UAAMtB,OAAO,GAAG3D,OAAO,CAAC2D,OAAxB;AACA,UAAMhC,QAAQ,GAAG,KAAKb,OAAL,CAAagJ,YAA9B;AACA,UAAMC,QAAQ,GAAG,KAAKjJ,OAAL,CAAa0E,YAA9B;AACA,UAAMwE,gBAAgB,GAAI,yCAAyCtE,IAAzC,CAA8CT,KAA9C,CAA1B;AACA,UAAMgF,YAAY,GAAG,CAACtI,QAAD,GAAY,KAAZ,GAAoB,KAAKrB,EAAL,CAAQsI,MAAR,CAAe,MAAM3D,KAAK,CAACU,MAAN,CAAa,CAAb,EAAgBhE,QAAQ,CAACQ,MAAzB,CAArB,EAAuDuD,IAAvD,CAA4D/D,QAA5D,CAAzC;AACA3B,IAAAA,OAAO,CAACkD,SAAR,GAAoBS,OAAO,CAAC8B,WAAR,GAAsB,CAACR,KAAD,GAAS,EAAT,GAAc8E,QAAQ,GAAG9E,KAAH,GAAYtD,QAAQ,IAAI,CAACqI,gBAAb,IAAiC,CAACC,YAAnC,GAAmDtI,QAAQ,GAAGsD,KAA9D,GAAsE+E,gBAAgB,GAAG/E,KAAH,GAAW,SAASS,IAAT,CAAcT,KAAd,IAAuB,YAAYA,KAAnC,GAA2C,KAAKjF,OAAL,CAAaC,MAAb,CAAoBI,IAApB,IAA4B,MAAMqF,IAAN,CAAWT,KAAX,IAAoB,EAApB,GAAyB,GAArD,IAA4DA,KAAnR;;AAEA,QAAIA,KAAK,CAAC1C,OAAN,CAAc,GAAd,MAAuB,CAA3B,EAA8B;AAC1BvC,MAAAA,OAAO,CAAC4B,QAAR,CAAiB0E,KAAjB,CAAuBE,OAAvB,GAAiC,OAAjC;AACA,WAAKnF,IAAL,CAAUgF,QAAV,CAAmBrG,OAAO,CAAC4D,cAA3B,EAA2C,QAA3C;AACH,KAHD,MAGO;AACH5D,MAAAA,OAAO,CAAC4B,QAAR,CAAiB0E,KAAjB,CAAuBE,OAAvB,GAAiC,MAAjC;AACA,WAAKnF,IAAL,CAAU6F,WAAV,CAAsBlH,OAAO,CAAC4D,cAA9B,EAA8C,QAA9C;AACH;;AAED,QAAIqB,KAAK,CAAC1C,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAxB,IAA6BvC,OAAO,CAAC0D,aAAR,CAAsBlB,OAAvD,EAAgE;AAC5DxC,MAAAA,OAAO,CAAC+B,QAAR,CAAiBuE,KAAjB,CAAuBE,OAAvB,GAAiC,OAAjC;AACH,KAFD,MAEO;AACHxG,MAAAA,OAAO,CAAC+B,QAAR,CAAiBuE,KAAjB,CAAuBE,OAAvB,GAAiC,MAAjC;AACH;AACJ,GA/SU;AAiTX0D,EAAAA,MAAM,EAAE,UAAUjK,MAAV,EAAkB6E,aAAlB,EAAiC;AACrC,QAAI,CAAC7E,MAAL,EAAa;AACb6E,IAAAA,aAAa,CAAC7B,UAAd,GAA2BhD,MAA3B;AACA6E,IAAAA,aAAa,CAAC5B,SAAd,GAA0BjD,MAAM,CAACsF,IAAjC;AACAT,IAAAA,aAAa,CAAC9B,UAAd,GAA2B/C,MAAM,CAACqC,GAAP,CAAWnB,KAAX,CAAiB,GAAjB,CAA3B;AACH,GAtTU;AAwTXgJ,EAAAA,YAAY,EAAE,UAAUlK,MAAV,EAAkByB,GAAlB,EAAuB0I,GAAvB,EAA4BtF,aAA5B,EAA2CuF,OAA3C,EAAoD;AAC9D;AACA,QAAI,CAAC,MAAM3E,IAAN,CAAWhE,GAAX,CAAD,IAAoBoD,aAAa,CAACpB,aAAd,CAA4BlB,OAApD,EAA6D;AACzDvC,MAAAA,MAAM,CAACqK,YAAP,CAAoB,UAApB,EAAgCF,GAAG,IAAI1I,GAAvC;AACH,KAFD,MAEO;AACHzB,MAAAA,MAAM,CAACsK,eAAP,CAAuB,UAAvB;AACH,KAN6D,CAQ9D;;;AACA,QAAIzF,aAAa,CAAC7C,cAAd,CAA6BO,OAAjC,EAA0CvC,MAAM,CAAC6F,MAAP,GAAgB,QAAhB,CAA1C,KACK7F,MAAM,CAACsK,eAAP,CAAuB,QAAvB,EAVyD,CAY9D;;AACA,UAAMjI,GAAG,GAAGwC,aAAa,CAAC9B,UAAd,CAAyB6E,IAAzB,CAA8B,GAA9B,CAAZ;AACA,QAAI,CAACvF,GAAL,EAAUrC,MAAM,CAACsK,eAAP,CAAuB,KAAvB,EAAV,KACKtK,MAAM,CAACqC,GAAP,GAAaA,GAAb,CAfyD,CAiB9D;;AACArC,IAAAA,MAAM,CAACsF,IAAP,GAAc7D,GAAd;AACAzB,IAAAA,MAAM,CAACqK,YAAP,CAAoB,KAApB,EAA2BF,GAA3B;;AACA,QAAIC,OAAJ,EAAa;AACT,UAAIpK,MAAM,CAACuK,QAAP,CAAgBrI,MAAhB,KAA2B,CAA/B,EAAkClC,MAAM,CAACwF,WAAP,GAAqB,EAArB;AACrC,KAFD,MAEO;AACHxF,MAAAA,MAAM,CAACwF,WAAP,GAAqB2E,GAArB;AACH;AACJ,GAjVU;AAmVXK,EAAAA,YAAY,EAAE,UAAU3F,aAAV,EAAyBuF,OAAzB,EAAkC;AAC5C,QAAIvF,aAAa,CAAC5B,SAAd,CAAwBf,MAAxB,KAAmC,CAAvC,EAA0C,OAAO,IAAP;AAE1C,UAAMT,GAAG,GAAGoD,aAAa,CAAC5B,SAA1B;AACA,UAAMjD,MAAM,GAAG6E,aAAa,CAACrB,UAA7B;AACA,UAAMA,UAAU,GAAGxD,MAAM,CAACgF,KAAP,CAAa9C,MAAb,KAAwB,CAAxB,GAA4BT,GAA5B,GAAkCzB,MAAM,CAACgF,KAA5D;AAEA,UAAMyF,EAAE,GAAG5F,aAAa,CAAC7B,UAAd,IAA4B,KAAK5B,IAAL,CAAUC,aAAV,CAAwB,GAAxB,CAAvC;AACA,SAAKO,OAAL,CAAa5B,MAAb,CAAoBkK,YAApB,CAAiCO,EAAjC,EAAqChJ,GAArC,EAA0C+B,UAA1C,EAAsDqB,aAAtD,EAAqEuF,OAArE;AAEAvF,IAAAA,aAAa,CAAC5B,SAAd,GAA0B4B,aAAa,CAACnB,OAAd,CAAsB8B,WAAtB,GAAoCX,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+BH,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,GAAiC,EAA9H;AAEA,WAAOyF,EAAP;AACH,GAhWU;AAkWX9F,EAAAA,sBAAsB,EAAE,UAAUE,aAAV,EAAyB;AAC7C,QAAIpD,GAAG,GAAGoD,aAAa,CAAChC,QAAd,CAAuBmC,KAAjC;;AACA,QAAI,MAAMS,IAAN,CAAWhE,GAAX,CAAJ,EAAqB;AACjBA,MAAAA,GAAG,GAAGA,GAAG,CAACiE,MAAJ,CAAW,CAAX,CAAN;AACAb,MAAAA,aAAa,CAAClD,QAAd,CAAuB0E,KAAvB,CAA6BE,OAA7B,GAAuC,MAAvC;AACA,WAAKnF,IAAL,CAAU6F,WAAV,CAAsBpC,aAAa,CAAClB,cAApC,EAAoD,QAApD;AACA,WAAK/B,OAAL,CAAalC,UAAb,CAAwBoJ,KAAxB,CAA8BlF,IAA9B,CAAmC,IAAnC,EAAyC,KAAK7D,OAAL,CAAaL,UAAb,CAAwBgB,aAAjE;AACH,KALD,MAKO;AACHe,MAAAA,GAAG,GAAG,MAAMA,GAAZ;AACAoD,MAAAA,aAAa,CAAClD,QAAd,CAAuB0E,KAAvB,CAA6BE,OAA7B,GAAuC,OAAvC;AACA,WAAKnF,IAAL,CAAUgF,QAAV,CAAmBvB,aAAa,CAAClB,cAAjC,EAAiD,QAAjD;AACAkB,MAAAA,aAAa,CAACpB,aAAd,CAA4BlB,OAA5B,GAAsC,KAAtC;AACAsC,MAAAA,aAAa,CAAC/C,QAAd,CAAuBuE,KAAvB,CAA6BE,OAA7B,GAAuC,MAAvC;AACA,WAAK3E,OAAL,CAAa5B,MAAb,CAAoBkI,gBAApB,CAAqCtE,IAArC,CAA0C,IAA1C,EAAgDiB,aAAhD,EAA+D,KAAK9E,OAAL,CAAaL,UAAb,CAAwBgB,aAAvF,EAAsGe,GAAtG;AACH;;AAEDoD,IAAAA,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+BvD,GAA/B;AACA,SAAKG,OAAL,CAAa5B,MAAb,CAAoB+F,cAApB,CAAmCnC,IAAnC,CAAwC,IAAxC,EAA8CiB,aAA9C,EAA6DpD,GAA7D;AACAoD,IAAAA,aAAa,CAAChC,QAAd,CAAuB8G,KAAvB;AACH,GArXU;AAuXXvF,EAAAA,uBAAuB,EAAE,UAAUS,aAAV,EAAyBkC,CAAzB,EAA4B;AACjD,QAAI,OAAOlC,aAAa,CAAC/B,cAAd,CAA6BO,gBAApC,KAAyD,QAA7D,EAAuE;;AACvE,QAAI0D,CAAC,CAAClB,MAAF,CAAStD,OAAb,EAAsB;AAClB,WAAKX,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAqD,KAAKjD,OAAL,CAAa5B,MAAb,CAAoB0K,SAApB,CAA8B9G,IAA9B,CAAmC,IAAnC,EAAyCiB,aAAzC,EAAwDA,aAAa,CAAC/B,cAAd,CAA6BO,gBAArF,CAArD;AACH,KAFD,MAEO;AACH,WAAKzB,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAqD,KAAKjD,OAAL,CAAa5B,MAAb,CAAoB2K,UAApB,CAA+B/G,IAA/B,CAAoC,IAApC,EAA0CiB,aAA1C,EAAyDA,aAAa,CAAC/B,cAAd,CAA6BO,gBAAtF,CAArD;AACH;AACJ,GA9XU;AAgYXgB,EAAAA,sBAAsB,EAAE,UAAUQ,aAAV,EAAyBkC,CAAzB,EAA4B;AAChD,QAAIA,CAAC,CAAClB,MAAF,CAAStD,OAAb,EAAsB;AAClBsC,MAAAA,aAAa,CAAC/C,QAAd,CAAuBuE,KAAvB,CAA6BE,OAA7B,GAAuC,OAAvC;AACA1B,MAAAA,aAAa,CAAClD,QAAd,CAAuB0E,KAAvB,CAA6BE,OAA7B,GAAuC,MAAvC;AACA,WAAKnF,IAAL,CAAU6F,WAAV,CAAsBpC,aAAa,CAAClB,cAApC,EAAoD,QAApD;AACAkB,MAAAA,aAAa,CAAC5B,SAAd,GAA0B4B,aAAa,CAACnB,OAAd,CAAsB8B,WAAtB,GAAoCX,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+BH,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,CAA6BvE,OAA7B,CAAqC,MAArC,EAA6C,EAA7C,CAA7F;;AACA,UAAI,OAAOoE,aAAa,CAAC/B,cAAd,CAA6BQ,cAApC,KAAuD,QAA3D,EAAqE;AACjE,aAAK1B,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAqD,KAAKjD,OAAL,CAAa5B,MAAb,CAAoB0K,SAApB,CAA8B9G,IAA9B,CAAmC,IAAnC,EAAyCiB,aAAzC,EAAwDA,aAAa,CAAC/B,cAAd,CAA6BQ,cAArF,CAArD;AACH;AACJ,KARD,MAQO;AACHuB,MAAAA,aAAa,CAAC/C,QAAd,CAAuBuE,KAAvB,CAA6BE,OAA7B,GAAuC,MAAvC;;AACA,UAAI,OAAO1B,aAAa,CAAC/B,cAAd,CAA6BQ,cAApC,KAAuD,QAA3D,EAAqE;AACjE,aAAK1B,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAqD,KAAKjD,OAAL,CAAa5B,MAAb,CAAoB2K,UAApB,CAA+B/G,IAA/B,CAAoC,IAApC,EAA0CiB,aAA1C,EAAyDA,aAAa,CAAC/B,cAAd,CAA6BQ,cAAtF,CAArD;AACH;AACJ;AACJ,GA/YU;AAiZXoH,EAAAA,SAAS,EAAE,UAAU7F,aAAV,EAAyBgD,OAAzB,EAAkC;AACzC,UAAMP,OAAO,GAAGzC,aAAa,CAAC9B,UAA9B;AACA,QAAI,CAAC8E,OAAL,EAAc,OAAOP,OAAO,CAACM,IAAR,CAAa,GAAb,CAAP;;AAEd,QAAI,UAAUnC,IAAV,CAAeoC,OAAf,CAAJ,EAA6B;AACzBA,MAAAA,OAAO,GAAGA,OAAO,CAACpH,OAAR,CAAgB,SAAhB,EAA2B,EAA3B,EAA+B2C,IAA/B,EAAV;AACAyB,MAAAA,aAAa,CAAC9B,UAAd,GAA2B8E,OAAO,CAAC3G,KAAR,CAAc,GAAd,CAA3B;AACA,aAAO2G,OAAP;AACH;;AAED,UAAME,IAAI,GAAGF,OAAO,CAAC3G,KAAR,CAAc,GAAd,CAAb;;AACA,SAAK,IAAIiB,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG2F,IAAI,CAAC7F,MAAtB,EAA8BsF,KAAnC,EAA0CrF,CAAC,GAAGC,GAA9C,EAAmDD,CAAC,EAApD,EAAwD;AACpDqF,MAAAA,KAAK,GAAGF,OAAO,CAAChF,OAAR,CAAgByF,IAAI,CAAC5F,CAAD,CAApB,CAAR;AACA,UAAIqF,KAAK,KAAK,CAAC,CAAf,EAAkBF,OAAO,CAACG,IAAR,CAAaM,IAAI,CAAC5F,CAAD,CAAjB;AACrB;;AAED,WAAOmF,OAAO,CAACM,IAAR,CAAa,GAAb,CAAP;AACH,GAlaU;AAoaX+C,EAAAA,UAAU,EAAE,UAAU9F,aAAV,EAAyBgD,OAAzB,EAAkC;AAC1C,QAAI,CAACA,OAAL,EAAc,OAAOhD,aAAa,CAAC9B,UAAd,CAAyB6E,IAAzB,CAA8B,GAA9B,CAAP;AACd,QAAI,UAAUnC,IAAV,CAAeoC,OAAf,CAAJ,EAA6BA,OAAO,GAAGA,OAAO,CAACpH,OAAR,CAAgB,SAAhB,EAA2B,EAA3B,EAA+B2C,IAA/B,EAAV;AAE7B,UAAM2E,IAAI,GAAGlD,aAAa,CAAC9B,UAAd,CAAyB6E,IAAzB,CAA8B,GAA9B,EAAmCnH,OAAnC,CAA2C,KAAKJ,EAAL,CAAQsI,MAAR,CAAed,OAAO,GAAG,MAAzB,CAA3C,EAA6E,EAA7E,CAAb;AACAhD,IAAAA,aAAa,CAAC9B,UAAd,GAA2BgF,IAAI,CAAC7G,KAAL,CAAW,GAAX,CAA3B;AACA,WAAO6G,IAAP;AACH,GA3aU;AA6aXhD,EAAAA,IAAI,EAAE,UAAUF,aAAV,EAAyB;AAC3BA,IAAAA,aAAa,CAAC7B,UAAd,GAA2B,IAA3B;AACA6B,IAAAA,aAAa,CAAC5B,SAAd,GAA0B4B,aAAa,CAACnB,OAAd,CAAsB8B,WAAtB,GAAoCX,aAAa,CAAChC,QAAd,CAAuBmC,KAAvB,GAA+B,EAA7F;AACAH,IAAAA,aAAa,CAACrB,UAAd,CAAyBwB,KAAzB,GAAiC,EAAjC;AACAH,IAAAA,aAAa,CAAC7C,cAAd,CAA6BO,OAA7B,GAAuC,KAAvC;AACAsC,IAAAA,aAAa,CAACpB,aAAd,CAA4BlB,OAA5B,GAAsC,KAAtC;AACAsC,IAAAA,aAAa,CAAC3B,OAAd,GAAwB,KAAxB;AACA,SAAKtB,OAAL,CAAa5B,MAAb,CAAoB8F,MAApB,CAA2BlC,IAA3B,CAAgC,IAAhC,EAAsCiB,aAAtC,EAAqDA,aAAa,CAAC9D,UAAnE;;AACA,QAAI8D,aAAa,CAACjE,OAAlB,EAA2B;AACvB,WAAKgB,OAAL,CAAa5B,MAAb,CAAoBkG,aAApB,CAAkCtC,IAAlC,CAAuC,IAAvC,EAA6CiB,aAA7C,EAA4D,KAA5D;AACH;;AACD,SAAK9E,OAAL,CAAaC,MAAb,CAAoBU,aAApB,GAAoC,IAApC;AACA,SAAKkB,OAAL,CAAalC,UAAb,CAAwBqF,IAAxB,CAA6BnB,IAA7B,CAAkC,IAAlC,EAAwC,KAAK7D,OAAL,CAAaL,UAAb,CAAwBgB,aAAhE;AACH;AA1bU,CAAf","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\n\nexport default {\n    name: 'anchor',\n    add: function (core) {\n        core.addModule([selectMenu]);\n        \n        core.context.anchor = {\n            caller: {},\n            forms: this.setDialogForm(core),\n            host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n            callerContext: null\n        };\n    },\n\n    /** dialog */\n    setDialogForm: function (core) {\n        const lang = core.lang;\n        const relList = core.options.linkRel;\n        const defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n        const icons = core.icons;\n        const forms = core.util.createElement('DIV');\n\n        let html = '<div class=\"se-dialog-body\">' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.url + '</label>' +\n                '<div class=\"se-dialog-form-files\">' +\n                    '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' +\n                    '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' +\n                    core.plugins.selectMenu.setForm() +\n                '</div>' +\n                '<div class=\"se-anchor-preview-form\">' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' +\n                    '<pre class=\"se-link-preview\"></pre>' +\n                '</div>' +\n            '</div>' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' +\n            '</div>' +\n            '<div class=\"se-dialog-form-footer\">' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n            if (relList.length > 0) {\n                html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' +\n                    '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' +\n                    '<div class=\"se-list-layer\">' +\n                        '<div class=\"se-list-inner\">' +\n                            '<ul class=\"se-list-basic se-list-checked\">';\n                for (let i = 0, len = relList.length, rel; i < len; i++) {\n                    rel = relList[i];\n                    html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n                }\n                html += '</ul></div></div></div>';\n            }\n\n        html += '</div></div>';\n\n        forms.innerHTML = html;\n        return forms;\n    },\n\n    initEvent: function (pluginName, forms) {\n        const anchorPlugin = this.plugins.anchor;\n        const context = this.context.anchor.caller[pluginName] = {\n            modal: forms,\n            urlInput: null,\n            linkDefaultRel: this.options.linkRelDefault,\n            defaultRel: this.options.linkRelDefault.default || '',\n            currentRel: [],\n            linkAnchor: null,\n            linkValue: '',\n            _change: false,\n            callerName: pluginName\n        };\n\n        if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n        if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n        if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n\n        context.urlInput = forms.querySelector('.se-input-url');\n        context.anchorText = forms.querySelector('._se_anchor_text');\n        context.newWindowCheck = forms.querySelector('._se_anchor_check');\n        context.downloadCheck = forms.querySelector('._se_anchor_download');\n        context.download = forms.querySelector('._se_anchor_download_icon');\n        context.preview = forms.querySelector('.se-link-preview');\n        context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n        context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n\n        this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n        const listContext = this.context.selectMenu.caller[pluginName];\n        \n        /** rel */\n        if (this.options.linkRel.length > 0) {\n            context.relButton = forms.querySelector('.se-anchor-rel-btn');\n            context.relList = forms.querySelector('.se-list-layer');\n            context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n            context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n            context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n        }\n\n        context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n        context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n        context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n        context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n        context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n        context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n        context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n        context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n    },\n\n    on: function (contextAnchor, update) {\n        if (!update) {\n            this.plugins.anchor.init.call(this, contextAnchor);\n            contextAnchor.anchorText.value = this.getSelection().toString().trim();\n            contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n        } else if (contextAnchor.linkAnchor) {\n            this.context.dialog.updateModal = true;\n            const href = this.options.linkNoPrefix ? contextAnchor.linkAnchor.href.replace(contextAnchor.linkAnchor.origin + '/', '') : contextAnchor.linkAnchor.href;\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = /\\#.+$/.test(href) ? href.substr(href.lastIndexOf('#')) : href;\n            contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n            contextAnchor.newWindowCheck.checked = (/_blank/i.test(contextAnchor.linkAnchor.target) ? true : false);\n            contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n        }\n\n        this.context.anchor.callerContext = contextAnchor;\n        this.plugins.anchor.setRel.call(this, contextAnchor, (update && contextAnchor.linkAnchor) ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n        this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n    },\n\n    _closeRelMenu: null,\n    toggleRelList: function (contextAnchor, show) {\n        if (!show) {\n            if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n        } else {\n            const target = contextAnchor.relButton;\n            const relList = contextAnchor.relList;\n            this.util.addClass(target, 'active');\n            relList.style.visibility = 'hidden';\n            relList.style.display = 'block';\n            if (!this.options.rtl) relList.style.left = (target.offsetLeft + target.offsetWidth + 1) + 'px';\n            else relList.style.left = (target.offsetLeft - relList.offsetWidth - 1) + 'px';\n            relList.style.top = (target.offsetTop + (target.offsetHeight / 2) - (relList.offsetHeight / 2)) + 'px';\n            relList.style.visibility = '';\n\n            this.plugins.anchor._closeRelMenu = function (context, target, e) {\n                if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n                this.util.removeClass(target, 'active');\n                context.relList.style.display = 'none';\n                this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n                this.plugins.anchor._closeRelMenu = null;\n            }.bind(this, contextAnchor, target);\n    \n            this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n        }\n    },\n\n    onClick_relButton: function (contextAnchor, e) {\n        this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n    },\n\n    onClick_relList: function (contextAnchor, e) {\n        const target = e.target;\n        const cmd = target.getAttribute('data-command');\n        if (!cmd) return;\n        \n        const current = contextAnchor.currentRel;\n        const checked = this.util.toggleClass(target, 'se-checked');\n        const index = current.indexOf(cmd);\n        if (checked) {\n            if (index === -1) current.push(cmd);\n        } else {\n            if (index > -1) current.splice(index, 1);\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n    },\n\n    setRel: function (contextAnchor, relAttr) {\n        const relListEl = contextAnchor.relList;\n        const rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n        if (!relListEl) return;\n\n        const checkedRel = relListEl.querySelectorAll('button');\n        for (let i = 0, len = checkedRel.length, cmd; i < len; i++) {\n            cmd = checkedRel[i].getAttribute('data-command');\n            if (rels.indexOf(cmd) > -1) {\n                this.util.addClass(checkedRel[i], 'se-checked');\n            } else {\n                this.util.removeClass(checkedRel[i], 'se-checked');\n            }\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n    },\n\n    createHeaderList: function (contextAnchor, contextList, urlValue) {\n        const headers = this.util.getListChildren(this.context.element.wysiwyg, function(current) {\n            return /h[1-6]/i.test(current.nodeName);\n        });\n        if (headers.length === 0) return;\n\n        const valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n        const list = [];\n        let html = '';\n        for(let i = 0, len = headers.length, h; i < len; i++) {\n            h = headers[i];\n            if (!valueRegExp.test(h.textContent)) continue;\n            list.push(h);\n            html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n        }\n\n        if (list.length === 0) {\n            this.plugins.selectMenu.close.call(this, contextList);\n        } else {\n            this.plugins.selectMenu.createList(contextList, list, html);\n            this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n        }\n    },\n\n    _setMenuListPosition: function (contextAnchor, list) {\n        list.style.top = (contextAnchor.urlInput.offsetHeight + 1) + 'px';\n    },\n\n    onKeyDownUrlInput: function (contextList, e) {\n        const keyCode = e.keyCode;\n        switch (keyCode) {\n            case 38: // up\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n                break;\n            case 40: // down\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n                break;\n            case 13: // enter\n                if (contextList.index > -1) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n                }\n                break;\n        }\n    },\n\n    setHeaderBookmark: function (header) {\n        const contextAnchor = this.context.anchor.callerContext;\n        const id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n        header.id = id;\n        contextAnchor.urlInput.value = '#' + id;\n\n        if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n            contextAnchor.anchorText.value = header.textContent;\n        }\n        \n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n        this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        this.context.anchor.callerContext.urlInput.focus();\n    },\n\n    onChangeAnchorText: function (contextAnchor, e) {\n        contextAnchor._change = !!e.target.value.trim();\n    },\n\n    onChangeUrlInput: function (contextAnchor, e) {\n        const value = e.target.value.trim();\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n\n        if (/^#/.test(value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);\n        else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    },\n\n    onFocusUrlInput: function (contextAnchor, contextLink) {\n        const value = contextAnchor.urlInput.value;\n        if (/^#/.test(value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n    },\n\n    onBlurUrlInput: function (contextList) {\n        this.plugins.selectMenu.close.call(this, contextList);\n    },\n\n    setLinkPreview: function (context, value) {\n        const preview = context.preview;\n        const protocol = this.options.linkProtocol;\n        const noPrefix = this.options.linkNoPrefix;\n        const reservedProtocol  = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n        const sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n        context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : (protocol && !reservedProtocol && !sameProtocol) ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n        if (value.indexOf('#') === 0) {\n            context.bookmark.style.display = 'block';\n            this.util.addClass(context.bookmarkButton, 'active');\n        } else {\n            context.bookmark.style.display = 'none';\n            this.util.removeClass(context.bookmarkButton, 'active');\n        }\n\n        if (value.indexOf('#') === -1 && context.downloadCheck.checked) {\n            context.download.style.display = 'block';\n        } else {\n            context.download.style.display = 'none';\n        }\n    },\n\n    setCtx: function (anchor, contextAnchor) {\n        if (!anchor) return;\n        contextAnchor.linkAnchor = anchor;\n        contextAnchor.linkValue = anchor.href;\n        contextAnchor.currentRel = anchor.rel.split(\" \");\n    },\n\n    updateAnchor: function (anchor, url, alt, contextAnchor, notText) {\n        // download\n        if (!/^\\#/.test(url) && contextAnchor.downloadCheck.checked) {\n            anchor.setAttribute('download', alt || url);\n        } else {\n            anchor.removeAttribute('download');\n        }\n\n        // new window\n        if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';\n        else anchor.removeAttribute('target');\n        \n        // rel\n        const rel = contextAnchor.currentRel.join(' ');\n        if (!rel) anchor.removeAttribute('rel');\n        else anchor.rel = rel;\n\n        // est url, alt\n        anchor.href = url;\n        anchor.setAttribute('alt', alt);\n        if (notText) {\n            if (anchor.children.length === 0) anchor.textContent = '';\n        } else {\n            anchor.textContent = alt;\n        }\n    },\n\n    createAnchor: function (contextAnchor, notText) {\n        if (contextAnchor.linkValue.length === 0) return null;\n        \n        const url = contextAnchor.linkValue;\n        const anchor = contextAnchor.anchorText;\n        const anchorText = anchor.value.length === 0 ? url : anchor.value;\n\n        const oA = contextAnchor.linkAnchor || this.util.createElement('A');\n        this.plugins.anchor.updateAnchor(oA, url, anchorText, contextAnchor, notText);\n\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n\n        return oA;\n    },\n\n    onClick_bookmarkButton: function (contextAnchor) {\n        let url = contextAnchor.urlInput.value;\n        if (/^\\#/.test(url)) {\n            url = url.substr(1);\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        } else {\n            url = '#' + url;\n            contextAnchor.bookmark.style.display = 'block';\n            this.util.addClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.downloadCheck.checked = false;\n            contextAnchor.download.style.display = 'none';\n            this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n        }\n\n        contextAnchor.urlInput.value = url;\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n        contextAnchor.urlInput.focus();\n    },\n\n    onChange_newWindowCheck: function (contextAnchor, e) {\n        if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n        if (e.target.checked) {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        } else {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        }\n    },\n\n    onChange_downloadCheck: function (contextAnchor, e) {\n        if (e.target.checked) {\n            contextAnchor.download.style.display = 'block';\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        } else {\n            contextAnchor.download.style.display = 'none';\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        }\n    },\n\n    _relMerge: function (contextAnchor, relAttr) {\n        const current = contextAnchor.currentRel;\n        if (!relAttr) return current.join(' ');\n        \n        if (/^only\\:/.test(relAttr)) {\n            relAttr = relAttr.replace(/^only\\:/, '').trim();\n            contextAnchor.currentRel = relAttr.split(' ');\n            return relAttr;\n        }\n\n        const rels = relAttr.split(' ');\n        for (let i = 0, len = rels.length, index; i < len; i++) {\n            index = current.indexOf(rels[i]);\n            if (index === -1) current.push(rels[i]);\n        }\n\n        return current.join(' ');\n    },\n\n    _relDelete: function (contextAnchor, relAttr) {\n        if (!relAttr) return contextAnchor.currentRel.join(' ');\n        if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n\n        const rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n        contextAnchor.currentRel = rels.split(' ');\n        return rels;\n    },\n\n    init: function (contextAnchor) {\n        contextAnchor.linkAnchor = null;\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n        contextAnchor.anchorText.value = '';\n        contextAnchor.newWindowCheck.checked = false;\n        contextAnchor.downloadCheck.checked = false;\n        contextAnchor._change = false;\n        this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n        if (contextAnchor.relList) {\n            this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n        }\n        this.context.anchor.callerContext = null;\n        this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n    }\n};\n"]},"metadata":{},"sourceType":"module"}